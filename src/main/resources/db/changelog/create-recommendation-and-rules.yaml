databaseChangeLog:
  - changeSet:
      id: 1
      author: Stupendos
      changes:
        - sql:
            dbms: postgresql
            splitStatements: false
            endDelimiter: ";"
            sql: |
              CREATE TABLE IF NOT EXISTS public.recommendation (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                recommendation_id VARCHAR(255) NOT NULL,
                recommendation_name VARCHAR(255) NOT NULL,
                recommendation_text TEXT NOT NULL,
                CONSTRAINT recommendation_pkey PRIMARY KEY (id),
                CONSTRAINT unique_recommendation_id UNIQUE (recommendation_id)
              );

  - changeSet:
      id: 2
      author: Stupendos
      changes:
        - sql:
            dbms: postgresql
            splitStatements: false
            endDelimiter: ";"
            sql: |
              CREATE TABLE IF NOT EXISTS public.dynamic_rule (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                query VARCHAR(255) NOT NULL,
                arguments CHARACTER VARYING[],
                negate BOOLEAN NOT NULL,
                recommendation_id BIGINT NOT NULL,
                CONSTRAINT dynamic_rule_pkey PRIMARY KEY (id)
              );

        - addForeignKeyConstraint:
            baseTableName: dynamic_rule
            baseColumnNames: recommendation_id
            referencedTableName: recommendation
            referencedColumnNames: id
            constraintName: fk_dynamic_rule_recommendation
            onDelete: CASCADE

#  - changeSet:
#      id: 3
#      author: Stupendos
#      changes:
#        - createIndex:
#            tableName: recommendation
#            indexName: idx_recommendation_id
#            columns:
#              - column:
#                  name: recommendation_id
#
#        - createIndex:
#            tableName: dynamic_rule
#            indexName: idx_dynamic_rule_recommendation_id
#            columns:
#              - column:
#                  name: recommendation_id

