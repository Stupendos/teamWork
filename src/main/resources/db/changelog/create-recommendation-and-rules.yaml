databaseChangeLog:
  - changeSet:
      id: 1
      author: Stupendos
      changes:
        - sql:
            dbms: postgresql
            splitStatements: false
            endDelimiter: ";"
            sql: |
              CREATE TABLE IF NOT EXISTS public.recommendation (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                recommendation_id VARCHAR(255) NOT NULL,
                recommendation_name VARCHAR(255) NOT NULL,
                recommendation_text TEXT NOT NULL,
                CONSTRAINT recommendation_pkey PRIMARY KEY (id),
                CONSTRAINT unique_recommendation_id UNIQUE (recommendation_id)
              );

  - changeSet:
      id: 2
      author: Stupendos
      changes:
        - sql:
            dbms: postgresql
            splitStatements: false
            endDelimiter: ";"
            sql: |
              CREATE TABLE IF NOT EXISTS public.dynamic_rule (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                query VARCHAR(255) NOT NULL,
                arguments CHARACTER VARYING[],
                negate BOOLEAN NOT NULL,
                recommendation_id BIGINT NOT NULL,
                CONSTRAINT dynamic_rule_pkey PRIMARY KEY (id)
              );

        - addForeignKeyConstraint:
            baseTableName: dynamic_rule
            baseColumnNames: recommendation_id
            referencedTableName: recommendation
            referencedColumnNames: id
            constraintName: fk_dynamic_rule_recommendation
            onDelete: CASCADE

  - changeSet:
      id: 3
      author: Stupendos
      changes:
        - createTable:
            tableName: dynamic_rule_statistics
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: rule_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: trigger_count
                  type: INTEGER
                  defaultValueNumeric: 0
                  constraints:
                    nullable: false

        - addForeignKeyConstraint:
            baseTableName: dynamic_rule_statistics
            baseColumnNames: rule_id
            referencedTableName: dynamic_rule
            referencedColumnNames: id
            constraintName: fk_dynamic_rule_statistics_rule
            onDelete: CASCADE